---
title: "R Notebook"
output: html_notebook
---

```{r}
library(aplpack)
```

```{r}

data_prova <- data[,c(3, 5:9)]
set.seed(2024)
ind_outlying_obs <- c()
for (i in 1:5){
  for (j in ((i+1):6)){
    col_names <- c(names(data_prova)[i], names(data_prova)[j])  # Get column names for current bagplot
    x <- data_prova[, i] + rnorm(nrow(data_prova), 0, 0.4)  # Add jitter to x-axis
    y <- data_prova[, j] + rnorm(nrow(data_prova), 0, 0.4)  # Add jitter to y-axis
    df_i <- cbind(x, y)
    bagplot_i <- compute.bagplot(df_i)  # Set x-axis and y-axis labels with column names
    outliers_i <- bagplot_i$pxy.outlier
    indx_i <- which(apply(df_i, 1, function(x) all(x %in% outliers_i)))
    ind_outlying_obs <- append(ind_outlying_obs, indx_i)
  }
}

#bagplot_matrix <- aplpack::bagplot.pairs(df_3)
```


```{r}
table_out <- table(ind_outlying_obs)
sort(table_out)
```

```{r}
sorted_table <- sort(table_out, decreasing = TRUE)
top_outliers <- as.numeric(names((sorted_table)[1:5]))
# Assegna un colore diverso a ciascun outlier selezionato
library(RColorBrewer)
color_palette <- brewer.pal(n = 5, name = "Dark2")
# Crea un vettore di colori per ciascun outlier
outlier_colors <- setNames(color_palette, top_outliers)
set.seed(2024)
for (i in 1:5) {
  for (j in ((i + 1):6)) {
    col_names <-
      c(names(data_prova)[i], names(data_prova)[j])  # Get column names for current bagplot
    x <-
      data_prova[, i] + rnorm(nrow(data_prova), 0, 0.4)  # Add jitter to x-axis
    y <-
      data_prova[, j] + rnorm(nrow(data_prova), 0, 0.4)  # Add jitter to y-axis
    df_i <- cbind(x, y)
    bagplot_i <-
      bagplot(df_i, xlab = col_names[1], ylab = col_names[2])  # Set x-axis and y-axis labels with column names
    outliers_i <- bagplot_i$pxy.outlier
    indx_i <-
      which(apply(df_i, 1, function(x)
        all(x %in% outliers_i)))
    
    # Plot outliers with colors based on frequency
    for (outlier in top_outliers) {
      for (k in 1:length(indx_i)) {
        if (indx_i[k] == outlier) {
          points(
            df_i[indx_i[k], 1],
            df_i[indx_i[k], 2],
            col = outlier_colors[as.character(outlier)],
            pch = 19,
            cex = 1.5
          )
        }
      }
    }
    
    # Add legend
    legend("bottomright",
           legend = top_outliers,
           fill = color_palette,
           title = "Indexes")
  }
}
```



